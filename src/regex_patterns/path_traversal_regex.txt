# Path Traversal Detection Patterns (Consolidated & Expanded)
# Each non-empty, non-comment line is a regex alternation branch.

# 1. Universal Dot-Dot-Slash (Original Rules 1, 4)
# Improved: Handles mixed slashes (../, ..\, ..%2f) in one check
(?:\.{2,}[/\\]|%2e{2,})

# 2. Complex URL Encoding (Original Rules 2, 3, 5, 6)
# Improved: Handles double encoding, overlong UTF-8, and null bytes
(?:(?:%25)+2e(?:%25)+2e|%c0%ae|%00)

# 3. Nginx Alias Traversal (New)
# Detects /images../hash.png
(?:\.\./)

# 4. Stream Wrappers & Protocols (New - Critical for LFI)
# Detects php://filter, file://, expect://
(?:(?:php|file|zip|jar|gopher|expect)://)

# 5. Sensitive Unix Files (Original Rules 7, 8)
# Expanded: Added .ssh, .bash_history, and self/environ
(?:/(?:etc|proc|var|usr)/(?:passwd|shadow|hosts|crontab|issue|net/tcp|self/environ|self/fd))

# 6. Sensitive User/Config Files (New)
(?:/\.ssh/|/\.bash_history|/\.git/config)

# 7. Windows Absolute Paths (Original Rule 9)
(?:[a-zA-Z]:\\[wW]indows\\)

# 8. Windows System Files (Original Rules 10, 11)
(?:(?:boot\.ini|win\.ini|system\.ini|web\.config|global\.asa))

# 9. Cloud Metadata IP (New - SSRF Prevention)
# Blocks access to AWS/GCP/Azure instance metadata
(?:169\.254\.169\.254)