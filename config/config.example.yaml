# Max request body size in MB (413 if exceeded). 0 = no limit.
# Per-host override available.
max_request_body_mb: 10

# Global WAF configuration
# Inspects URI, custom headers, and request body for attack patterns.
# Per-host override available to disable for specific hosts.
waf:
  sql_injection:
    enabled: true
    block_mode: true       # false = log-only (detect but don't block)
  xss:
    enabled: true
    block_mode: true       # false = log-only (detect but don't block)
  command_injection:
    enabled: true
    block_mode: true       # false = log-only (detect but don't block)
  max_inspection_size_mb: 1 # Max body size to buffer for WAF pattern scanning

# Global rate limit (applies to all hosts unless overridden)
rate_limit:
  enabled: false
  requests: 100
  window_seconds: 1

# Global user-agent filter (blocks known bots/scanners with 403)
# Per-host override available to disable for specific hosts
user_agent_filter:
  enabled: true

# Optional default host: catch-all for requests whose Host header
# doesn't match any entry in 'hosts'. Omit to return 404 for unknown hosts.
# Supports both simple and extended format (same as hosts entries).
# default_host: "http://127.0.0.1:8080"

hosts:
  # Simple format: just upstream URL
  "example.local": "http://127.0.0.1:8081"
  "api.local": "https://192.168.99.23:8082"
  "test.com": "http://127.0.0.1:3000"

  # Extended format with session binding
  # Binds authenticated session cookies to client fingerprint attributes.
  # Requests presenting a session cookie from a mismatched client get 403.
  "dashboard.local":
    upstream: "https://192.168.99.23:8082"
    rate_limit:
      enabled: true
      requests: 50
      window_seconds: 1
    session_binding:
      cookie_name: "session_id"     # Name of the session cookie set by the upstream
      ttl_seconds: 86400            # How long a binding is kept (default: 86400 = 24h)
      bind_attributes:              # Which client attributes to bind:
        - ip                        #   Client IP address
        - tls                       #   TLS version + cipher suite
        - user_agent                #   User-Agent header

  # Disable user-agent filtering and WAF for API hosts that need tool access
  "api-internal.local":
    upstream: "http://127.0.0.1:9090"
    user_agent_filter:
      enabled: false
    waf:
      sql_injection:
        enabled: false
      xss:
        enabled: false
      command_injection:
        enabled: false

  # Per-host max request body size override (e.g. allow larger uploads)
  "uploads.local":
    upstream: "http://127.0.0.1:8085"
    max_request_body_mb: 50
